(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getSettings:()=>_,getSiteOptions:()=>k,getTemplateData:()=>v});var o={};e.r(o),e.d(o,{apiFetch:()=>w,setSettings:()=>S,setSiteOptions:()=>f,updateSiteOptions:()=>x});var n={};e.r(n),e.d(n,{API_FETCH:()=>E});var s={};e.r(s),e.d(s,{getSettings:()=>C,getSiteOptions:()=>T});const l=window.wp.element,r=window.wp.domReady;var c=e.n(r);const a=window.wp.components,i=window.wp.i18n,u=window.wp.hooks,g=window.wp.compose,p=window.wp.data,d=window.wp.url,b=window.wp.coreData,h=window.wp.apiFetch;var m=e.n(h);const y=window.lodash;(0,g.compose)((0,p.withSelect)((e=>{const{getPostTypes:t}=e(b.store);return{postTypesList:t()}})))((e=>{const{postTypesList:t,updateSettings:o,settings:n}=e;return(0,l.createElement)(l.Fragment,null,t&&t.map((e=>n.skip_gutenburg_post_type.includes(e.slug)?[]:(0,l.createElement)(a.PanelRow,{key:`post-type-${e.slug}`},(0,l.createElement)(a.ToggleControl,{label:e.labels.name,checked:n.active_post_types.includes(e.slug),onChange:()=>{const t=n.active_post_types;n.active_post_types.includes(e.slug)?(0,y.remove)(t,(t=>t===e.slug)):t.push(e.slug),o({...n,active_post_types:t})}})))))}));function _(e){return e.settings}function k(e){return e.site_options}function v(e,t){return e.templatesData[t]}function w(e){return{type:"API_FETCH",request:e}}function S(e){return{type:"SET_SETTINGS",settings:e}}function f(e){return{type:"SET_SITE_OPTIONS",site_options:{...e}}}function x(e){return{type:"UPDATE_SITE_OPTIONS",site_options:{...e}}}function E(e){let{request:t}=e;return m()(t).then((e=>!!(e&&e.success&&e.response)&&e.response))}function*C(){return S(yield w({path:"/gutenify/v1/get_settings/"}))}function*T(){return f({settings:yield w({path:"/gutenify/v1/get_site_options/"}),coreSettings:{}})}const O=(0,p.createReduxStore)("gutenify/settings",{reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{settings:!1,site_options:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SETTINGS":e.settings=t.settings;break;case"SET_SITE_OPTIONS":!e.site_options&&t.site_options&&(e.site_options={...t.site_options});break;case"UPDATE_SITE_OPTIONS":t.site_options&&(e.site_options={...t.site_options})}return{...e}},selectors:t,actions:o,controls:n,resolvers:s});(0,p.register)(O),window.wp.blockEditor;const $=e=>{const{clearable:t=!0}=e,{colors:o}=(0,p.useSelect)((e=>({colors:e("core/block-editor").getSettings().colors||[]})));return(0,l.createElement)(a.BaseControl,{label:e.label,id:"textcolor-1"},(0,l.createElement)(a.ColorPalette,{colors:o,value:e.value,onChange:t=>{e.onChange(t)},clearable:t}))},P=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,y.has)(e,"color.text")&&e.color.text,(0,y.has)(e,"color.background")&&e.color.background,(0,y.has)(e,"elements.h1.color.text")&&e.elements.h1.color.text;const n=(0,y.has)(e,"blocks.core/button.color.background")?e.blocks["core/button"].color.background:"",s=(0,y.has)(e,"blocks.core/button.color.text")?e.blocks["core/button"].color.text:"",l=((0,y.has)(e,"elements.link.color.text")&&e.elements.link.color.text,(0,y.has)(t,"elements.linkHover.color.text")?t.elements.linkHover.color.text:""),r=(0,y.has)(t,"blocks.core/button.hover.color.text")?t.blocks["core/button"].hover.color.text:"",c=(0,y.has)(t,"blocks.core/button.hover.color.background")?t.blocks["core/button"].hover.color.background:"";let a="";return a+=`${o?".editor-styles-wrapper ":""} .wp-block-button .wp-block-button__link{\n\t\t${s?`color: ${s};`:""}\n\t\t${n?`background-color: ${n};`:""}\n\t}`,n&&(a+=`${o?".editor-styles-wrapper ":""} .is-style-outline > .wp-block-button__link:not(.has-background){\n\t\t\t${n?"background-color: transparent;":""}\n\t\t}`),a+=`${o?".editor-styles-wrapper ":""} .wp-block-button.is-style-outline > .wp-block-button__link:not(.has-text-color){\n\t\t${n?`color: ${n};`:""}\n\t}`,a+=`${o?".editor-styles-wrapper ":""} .wp-block-button .wp-block-button__link.wp-block-button__link:not(.has-background):not(.has-text-color):hover,\n\t${o?".editor-styles-wrapper  .gutenify-button-link.wp-block-button__link.wp-block-button__link:not(.has-background):not(.has-text-color):hover,":""}\n\t${o?".editor-styles-wrapper ":""} .wp-block-button.is-style-outline .wp-block-button__link.wp-block-button__link:not(.has-background):not(.has-text-color):hover{\n\t\t${r?`color: ${r};`:""}\n\t\t${c?`background-color: ${c};`:""}\n\t}`,a+=`${o?".editor-styles-wrapper ":""} a:hover,a:active{\n\t\t${l?`color: ${l};`:""}\n\t}`,a};(0,u.addFilter)("gutenify-admin-settings","gutenify/admin/settings/heading",(e=>[...e,(0,l.createElement)(l.Fragment,{key:"gutenify-admin-settings-heading"},(0,l.createElement)("h1",null,(0,i.__)("Site Options")),(0,l.createElement)("p",{className:"description"},(0,i.__)("If you need any help please contact us from our support page.")))]));const I=e=>{document.addEventListener("copy",(function t(o){o.clipboardData.setData("text/plain",JSON.stringify(e)),o.preventDefault(),document.removeEventListener("copy",t,!0)}),!0),document.execCommand("copy")},B=(0,g.compose)((0,p.withSelect)((e=>{const{getSettings:t}=e("gutenify/settings");return{settings:t()}})),(0,p.withDispatch)((e=>{const{setSettings:t}=e("gutenify/settings");return{setSettings:t}})))((e=>{const[t,o]=(0,l.useState)({hasSettingChange:!1,isSettingsDisabled:!0,settingError:"",settingSuccess:""}),[n,s]=(0,l.useState)({}),[r,c]=(0,l.useState)({}),g=(0,d.getFragment)(window.location.href),h=(0,y.replace)(g,"#",""),{styleId:_,gStyle:k}=(0,p.useSelect)((e=>{const t=e(b.store);return{styleId:t.__experimentalGetCurrentGlobalStylesId(),gStyle:t.__experimentalGetCurrentThemeBaseGlobalStyles()}})),v=e=>{let t=e;if(e.indexOf("var(")>-1){const o=function(e){if(!e||!(0,y.isString)(e))return e;const t="var:",o="var(--wp--";let n;if(e.startsWith(t))n=e.slice(t.length).split("|");else{if(!e.startsWith(o)||!e.endsWith(")"))return e;n=e.slice(o.length,-")".length).split("--")}return n}(e);if(!(0,y.isEmpty)(o))if(o.includes("preset")&&o.includes("color")&&(0,y.has)(k,"settings.color.palette.theme")){const e=k.settings.color.palette.theme.filter((e=>e.slug===(0,y.last)(o)));(0,y.isEmpty)(e)||(t=e[0].color)}else o.includes("custom")&&o.includes("color")&&(0,y.has)(k,`settings.custom.color.${(0,y.last)(o)}`)&&(t=k.settings.custom.color[(0,y.last)(o)]);t.indexOf("var(")>-1&&(t=v(t))}return t};(0,l.useEffect)((()=>{_&&k&&m()({path:`/wp/v2/global-styles/${_}`,method:"get"}).then((e=>{console.log(e),console.log((0,y.merge)(k.styles,e.styles)),s((0,y.merge)(k.styles,e.styles)),o((e=>({...e,isSettingsDisabled:!1})))}))}),[_,k]),(0,l.useEffect)((()=>{m()({path:"/gutenify/v1/get_site_options",method:"get"}).then((e=>{e.success&&e.response&&c(e.response.styles)}))}),[]);const w=(0,y.has)(n,"color.text")?v(n.color.text):"",S=(0,y.has)(n,"color.background")?v(n.color.background):"",f=(0,y.has)(n,"elements.h1.color.text")?v(n.elements.h1.color.text):"",x=(0,y.has)(n,"blocks.core/button.color.background")?v(n.blocks["core/button"].color.background):"",E=(0,y.has)(n,"blocks.core/button.color.text")?v(n.blocks["core/button"].color.text):"",C=(0,y.has)(n,"elements.link.color.text")?v(n.elements.link.color.text):"",T=(0,y.has)(r,"elements.linkHover.color.text")?v(r.elements.linkHover.color.text):"",O=(0,y.has)(r,"blocks.core/button.hover.color.text")?v(r.blocks["core/button"].hover.color.text):"",B=(0,y.has)(r,"blocks.core/button.hover.color.background")?v(r.blocks["core/button"].hover.color.background):"";return(0,l.createElement)(a.Disabled,{isDisabled:t.isSettingsDisabled},(0,u.applyFilters)("gutenify-admin-settings",[],{...e,setAppState:o,appState:t,updateSettings:t=>{o((e=>({...e,hasSettingChange:!0}))),e.setSettings(t)},activePanel:h}),(0,l.createElement)($,{label:(0,i.__)("Text Color"),onChange:e=>{const t=(0,y.merge)(n,{color:{text:e}});s({...t})},value:w,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Site Background Color"),onChange:e=>{const t=(0,y.merge)(n,{color:{background:e}});s({...t})},value:S,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Heading Color"),onChange:e=>{const t=(0,y.merge)(n,{elements:{h1:{color:{text:e}},h2:{color:{text:e}},h3:{color:{text:e}},h4:{color:{text:e}},h5:{color:{text:e}},h6:{color:{text:e}}}});s({...t})},value:f,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Button background Color"),onChange:e=>{const t=(0,y.merge)(n,{blocks:{"core/button":{color:{background:e}}}});s({...t})},value:x,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Button Text Color"),onChange:e=>{const t=(0,y.merge)(n,{blocks:{"core/button":{color:{text:e}}}});s({...t})},value:E,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Link Color"),onChange:e=>{const t=(0,y.merge)(n,{elements:{link:{color:{text:e}}}});s({...t})},value:C,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Link Hover Color"),onChange:e=>{const t=(0,y.merge)(r,{elements:{linkHover:{color:{text:e}}}});c({...t})},value:T,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Button Hover Text Color"),onChange:e=>{const t=(0,y.merge)(r,{blocks:{"core/button":{hover:{color:{text:e}}}}});c({...t})},value:O,clearable:!1}),(0,l.createElement)($,{label:(0,i.__)("Button Hover Background Color"),onChange:e=>{const t=(0,y.merge)(r,{blocks:{"core/button":{hover:{color:{background:e}}}}});c({...t})},value:B,clearable:!1}),(0,l.createElement)(a.Button,{onClick:()=>{m()({path:`/wp/v2/global-styles/${_}`,method:"POST",data:{styles:n}}).then((e=>{console.log(e)})).catch((e=>{console.log(e)})),m()({path:"/gutenify/v1/update_site_options",method:"POST",data:{styles:r}}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}));const e=P(n,r),t=P(n,r,!0);m()({path:"/gutenify/v1/update_global_styles",method:"POST",data:{css:e,adminCss:t}}).then((e=>{})).catch((e=>{console.log(e)}))},variant:"primary"},"Save settings"),(0,l.createElement)(a.Button,{onClick:()=>{if(!window.confirm("Are you sure to reset?"))return!1;m()({path:`/wp/v2/global-styles/${_}`,method:"POST",data:{styles:{}}}).then((e=>{console.log(k.styles),s({}),s({...k.styles})})).catch((e=>{console.log(e)})),m()({path:"/gutenify/v1/update_site_options",method:"POST",data:{styles:{}}}).then((e=>{console.log(e),c({})})).catch((e=>{console.log(e)})),m()({path:"/gutenify/v1/update_global_styles",method:"POST",data:{css:"",adminCss:""}}).then((e=>{console.log(e)})).catch((e=>{console.log(e)})),location.reload()},variant:"secondary"},"Reset settings"),(0,l.createElement)(a.Button,{onClick:()=>{I({styles:n})}},"Copy Core Options"),(0,l.createElement)(a.Button,{onClick:()=>{I({styles:r})}},"Copy Custom Options"))}));c()((function(){const e="gutenify-site-options-app";void 0!==document.getElementById(e)&&null!==document.getElementById(e)&&(0,l.render)((0,l.createElement)(B,null),document.getElementById(e))}))})();